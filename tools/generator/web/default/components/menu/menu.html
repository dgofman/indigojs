<ul<%- opts.$attr('class') %><%- opts.$label(req, opts.title || 'Menu Control') %>><%
	var labelRenderer = opts.labelRenderer || function(item) { return item.label; };
	for (var index in opts.menus) {
		var menu = JSON.parse(JSON.stringify(opts.menus[index])),
			itemRenderer = menu.itemRenderer || opts.itemRenderer;
		menu.$get = opts.$get;
		menu.$attr = opts.$attr;
		menu.$attrs = opts.$attrs;

		if (itemRenderer) {
%>
	<%- itemRenderer(req, opts, menu, index) %>
<%
		} else {
			var label = labelRenderer(menu);
			if (menu.nav === opts.selected_nav) {
				menu.class = 'selected ' + (menu.class || '');
			}
%>
	<li<%- opts.$label(req, label) %><%- menu.$attrs('attrs') %><%- menu.$attr('class') %><%- menu.$attr('style') %><%- menu.$get('disabled', ' disabled') %>><a tabindex="-1" href="<%- menu.nav || '#' %>"><%- label %></a>
<%
	addSubmenu(menu);
%>
	</li><%
		}
	}
%>
</ul>

<%
	function addSubmenu(menu) {
		if (menu.sub) {
%>
		<ol style="list-style: none"><%
			for (var i in menu.sub) {
				var sub = menu.sub[i],
					label = labelRenderer(sub);
				sub.$get = opts.$get;
				sub.$attr = opts.$attr;
				sub.$attrs = opts.$attrs;
		%><li<%- opts.$label(req, label) %><%- sub.$attrs('attrs') %><%- sub.$attr('class') %><%- sub.$attr('style') %><%- sub.$get('disabled', ' disabled') %>><a tabindex="-1" href="<%- sub.nav || '#' %>"><%- label %></a><%

				addSubmenu(sub);
			}
		%></li></ol>
<%
		}
	}
%>